# План разработки проекта BizLevel

## Этап 1: Настройка проекта и окружения

- [ ] **Задача 1.1: Настройка базового Next.js приложения**
  - Инициализация Next.js 14+ с App Router и TypeScript
  - Настройка Tailwind CSS и установка shadcn/ui
  - Создание базовой структуры директорий согласно концепции
  - Настройка ESLint, Prettier для контроля качества кода

- [ ] **Задача 1.2: Настройка Supabase и интеграция с проектом**
  - Инициализация проекта Supabase
  - Установка и настройка Supabase CLI
  - Настройка базового подключения к Supabase
  - Создание конфигурации переменных окружения

- [ ] **Задача 1.3: Тестирование, рефакторинг и отправка в Git**
  - Проверка корректности инициализации проекта
  - Написание тестов для базовой интеграции с Supabase
  - Рефакторинг кода при необходимости
  - Создание первого коммита в Git с базовой структурой

## Этап 2: Модель данных и аутентификация

- [ ] **Задача 2.1: Создание схемы базы данных**
  - Создание SQL миграций для основных таблиц: profiles, levels, videos, quiz_questions, artifacts
  - Создание таблиц для прогресса: user_progress, user_video_progress, user_artifacts
  - Применение миграций к базе данных
  - Генерация TypeScript типов из схемы Supabase

- [ ] **Задача 2.2: Настройка аутентификации**
  - Настройка Supabase Auth для Email/Password
  - Создание клиента Supabase и SupabaseProvider
  - Настройка Row Level Security (RLS) для основных таблиц
  - Реализация хука useAuth для работы с аутентификацией

- [ ] **Задача 2.3: Реализация страниц аутентификации**
  - Создание страницы входа (login)
  - Создание страницы регистрации (register)
  - Создание страницы восстановления пароля (reset-password)
  - Реализация middleware для защиты маршрутов

- [ ] **Задача 2.4: Тестирование, рефакторинг и отправка в Git**
  - Тестирование функциональности аутентификации
  - Проверка работы политик безопасности
  - Рефакторинг кода аутентификации
  - Отправка изменений в Git

## Этап 3: Базовый макет и навигация

- [ ] **Задача 3.1: Создание основного макета**
  - Разработка компонента MainLayout для защищенных страниц
  - Создание компонента Sidebar с основной навигацией
  - Реализация Header с основной информацией о пользователе
  - Настройка переключения тем (светлая/темная)

- [ ] **Задача 3.2: Реализация базовых страниц**
  - Создание заглушек для основных страниц (/map, /profile, /artifacts, /chat, /faq)
  - Настройка маршрутизации между страницами
  - Адаптация макета для мобильных и десктопных устройств
  - Создание основных UI компонентов

- [ ] **Задача 3.3: Тестирование, рефакторинг и отправка в Git**
  - Проверка корректности работы макета и навигации
  - Тестирование адаптивности на разных устройствах
  - Рефакторинг компонентов и стилей
  - Отправка изменений в Git

## Этап 4: Карта уровней и отображение прогресса

- [ ] **Задача 4.1: Реализация карты уровней**
  - Создание сервиса levelService для работы с данными уровней
  - Разработка компонента LevelMap для отображения уровней
  - Визуализация различных состояний уровней (доступен, заблокирован, пройден)
  - Настройка навигации с карты на страницу уровня

- [ ] **Задача 4.2: Реализация прогресса пользователя**
  - Создание сервиса progressService для работы с прогрессом
  - Интеграция данных прогресса с отображением на карте
  - Создание тестовых данных для уровней и прогресса
  - Реализация базовой страницы уровня (/level/[levelId])

- [ ] **Задача 4.3: Тестирование, рефакторинг и отправка в Git**
  - Тестирование отображения уровней и прогресса
  - Проверка корректной работы навигации между уровнями
  - Рефакторинг компонентов карты уровней
  - Отправка изменений в Git

## Этап 5: Реализация страницы уровня

- [ ] **Задача 5.1: Интеграция видеоплеера**
  - Разработка компонента VideoSection для отображения YouTube-видео
  - Интеграция с YouTube Player API для отслеживания просмотра
  - Создание логики для отметки просмотренных видео
  - Загрузка и отображение списка видео для уровня

- [ ] **Задача 5.2: Реализация тестов**
  - Создание сервиса testService для работы с тестами
  - Разработка компонента TestSection для отображения тестов
  - Реализация логики проверки ответов и подсчета результатов
  - Сохранение результатов тестов в прогрессе пользователя

- [ ] **Задача 5.3: Работа с артефактами**
  - Создание сервиса artifactService для работы с артефактами
  - Реализация компонента для отображения и скачивания артефактов
  - Настройка интеграции с Supabase Storage для хранения файлов
  - Отслеживание скачанных артефактов в прогрессе

- [ ] **Задача 5.4: Тестирование, рефакторинг и отправка в Git**
  - Тестирование страницы уровня (видео, тесты, артефакты)
  - Проверка сохранения прогресса для каждого компонента
  - Рефакторинг компонентов страницы уровня
  - Отправка изменений в Git

## Этап 6: Логика завершения уровня и прогресса

- [ ] **Задача 6.1: Реализация завершения уровня**
  - Добавление логики проверки всех условий для завершения уровня
  - Создание компонента для отображения статуса завершения
  - Реализация кнопки "Завершить уровень" с соответствующей логикой
  - Обновление данных прогресса при завершении уровня

- [ ] **Задача 6.2: Разблокировка следующего уровня**
  - Реализация логики разблокировки следующего уровня
  - Обновление отображения на карте уровней
  - Создание уведомления о разблокировке нового уровня
  - Настройка перехода к следующему уровню

- [ ] **Задача 6.3: Тестирование, рефакторинг и отправка в Git**
  - Тестирование полного цикла прохождения уровня
  - Проверка корректности разблокировки следующего уровня
  - Рефакторинг логики прогресса и завершения
  - Отправка изменений в Git

## Этап 7: Профиль пользователя и артефакты

- [ ] **Задача 7.1: Реализация страницы профиля**
  - Создание компонентов для отображения информации о пользователе
  - Реализация отображения прогресса по уровням
  - Добавление возможности редактирования профиля
  - Реализация загрузки и отображения аватара

- [ ] **Задача 7.2: Страница доступных артефактов**
  - Создание страницы со списком всех доступных артефактов
  - Реализация фильтрации артефактов по уровням
  - Добавление возможности скачивания артефактов
  - Отслеживание скачиваний для статистики

- [ ] **Задача 7.3: Тестирование, рефакторинг и отправка в Git**
  - Тестирование функциональности профиля и артефактов
  - Проверка корректности отображения данных
  - Рефакторинг компонентов профиля и артефактов
  - Отправка изменений в Git

## Этап 8: Интеграция чата с ИИ-ассистентом

- [ ] **Задача 8.1: Настройка взаимодействия с OpenAI API**
  - Создание API-маршрута для обращения к OpenAI API
  - Настройка безопасного хранения API-ключа
  - Реализация базовой логики обработки запросов и ответов
  - Создание системного промпта для контекста

- [ ] **Задача 8.2: Реализация интерфейса чата**
  - Разработка компонента ChatWindow для страницы /chat
  - Создание хука useChat для работы с API
  - Реализация отображения истории сообщений
  - Добавление функциональности отправки сообщений

- [ ] **Задача 8.3: Сохранение истории чата**
  - Создание таблицы chat_messages в базе данных
  - Реализация сохранения сообщений пользователя и ответов ИИ
  - Добавление загрузки истории при открытии чата
  - Реализация пагинации для длинной истории

- [ ] **Задача 8.4: Тестирование, рефакторинг и отправка в Git**
  - Тестирование функциональности чата
  - Проверка сохранения и загрузки истории
  - Рефакторинг компонентов и логики чата
  - Отправка изменений в Git

## Этап 9: Дополнительные страницы и функциональность

- [ ] **Задача 9.1: Реализация страницы FAQ**
  - Создание таблицы faq в базе данных
  - Реализация загрузки данных FAQ из базы
  - Разработка компонентов для отображения вопросов и ответов
  - Добавление поиска по FAQ

- [ ] **Задача 9.2: Реализация страницы настроек**
  - Создание страницы настроек пользователя
  - Реализация смены личных данных
  - Добавление возможности смены пароля
  - Настройка уведомлений (опционально)

- [ ] **Задача 9.3: Тестирование, рефакторинг и отправка в Git**
  - Тестирование дополнительных страниц
  - Проверка всех функций настроек
  - Рефакторинг компонентов и логики
  - Отправка изменений в Git

## Этап 10: Интеграция платежной системы Stripe

- [ ] **Задача 10.1: Настройка Stripe**
  - Создание аккаунта в Stripe и настройка проекта
  - Интеграция Stripe с проектом через API
  - Настройка тестовых платежных методов
  - Создание базовых продуктов для оплаты

- [ ] **Задача 10.2: Реализация страницы оплаты**
  - Создание страницы выбора тарифа или уровня для оплаты
  - Интеграция Stripe Checkout для процесса оплаты
  - Реализация обработки успешной/неуспешной оплаты
  - Настройка редиректов после завершения оплаты

- [ ] **Задача 10.3: Обработка webhook'ов и разблокировка платного контента**
  - Создание эндпоинта для приема webhook'ов от Stripe
  - Реализация проверки подписи webhook'а
  - Добавление логики разблокировки платных уровней
  - Обновление прогресса пользователя после оплаты

- [ ] **Задача 10.4: Тестирование, рефакторинг и отправка в Git**
  - Тестирование платежей в тестовом режиме
  - Проверка корректной обработки webhook'ов
  - Рефакторинг платежной интеграции
  - Отправка изменений в Git

## Этап 11: Финализация MVP и общее тестирование

- [ ] **Задача 11.1: Комплексное тестирование**
  - Тестирование полного пользовательского пути
  - Проверка всех основных функций приложения
  - Тестирование на различных устройствах и браузерах
  - Составление списка багов и проблем

- [ ] **Задача 11.2: Оптимизация производительности**
  - Аудит и оптимизация запросов к Supabase
  - Проверка и оптимизация рендеринга компонентов
  - Оптимизация загрузки изображений и видео
  - Улучшение UX для критически важных функций

- [ ] **Задача 11.3: Подготовка к запуску**
  - Проверка всех переменных окружения
  - Настройка продакшн-окружения
  - Финальная проверка безопасности
  - Написание базовой документации для пользователей

- [ ] **Задача 11.4: Тестирование, рефакторинг и отправка в Git**
  - Финальное тестирование перед запуском
  - Исправление выявленных критических ошибок
  - Рефакторинг проблемных участков кода
  - Отправка финальных изменений в Git

## Этап 12: Администраторская панель (опционально)

- [ ] **Задача 12.1: Создание базовой админ-панели**
  - Создание защищенного маршрута /admin
  - Реализация проверки административных прав
  - Создание базового макета и навигации админ-панели
  - Реализация базовой статистики и обзора

- [ ] **Задача 12.2: Управление уровнями и контентом**
  - Создание интерфейса для управления уровнями
  - Реализация CRUD операций для видео и тестов
  - Добавление управления артефактами и FAQ
  - Реализация предпросмотра контента

- [ ] **Задача 12.3: Управление пользователями**
  - Создание интерфейса для просмотра списка пользователей
  - Реализация фильтрации и поиска пользователей
  - Добавление возможности просмотра прогресса пользователей
  - Реализация базовых административных функций

- [ ] **Задача 12.4: Тестирование, рефакторинг и отправка в Git**
  - Тестирование административных функций
  - Проверка безопасности и прав доступа
  - Рефакторинг компонентов админ-панели
  - Отправка изменений в Git