# Задача 6.1: Реализация завершения уровня

## Подготовка

Перед началом выполнения задачи, пожалуйста, ознакомьтесь с следующими документами для восстановления контекста:
- [Концепция проекта](../docs/bizlevel-concept.md)
- [План разработки](../docs/development-plan.md)
- [Текущий статус проекта](../docs/status.md)

## Описание задачи

Необходимо реализовать логику завершения уровня в приложении BizLevel. Система должна проверять выполнение всех условий для завершения уровня и предоставлять пользователю возможность отметить уровень как завершенный, что влияет на общий прогресс обучения.

### Шаги выполнения:

1. **Добавление логики проверки условий для завершения уровня:**
   - Разработать алгоритм проверки всех необходимых условий (просмотр видео, прохождение тестов, скачивание артефактов)
   - Реализовать функционал вычисления процента завершения уровня
   - Добавить методы в progressService для получения статуса завершенности уровня
   - Настроить сохранение состояния выполненных условий в базе данных

2. **Создание компонента для отображения статуса завершения:**
   - Разработать компонент LevelCompletionStatus для отображения прогресса и статуса завершения
   - Реализовать визуализацию выполненных и невыполненных условий
   - Добавить индикатор общего прогресса по уровню
   - Настроить адаптивное отображение на разных устройствах

3. **Реализация кнопки "Завершить уровень" с соответствующей логикой:**
   - Добавить кнопку "Завершить уровень" на страницу уровня
   - Реализовать обработку нажатия с проверкой всех условий
   - Добавить визуальную обратную связь (успех/ошибка)
   - Реализовать запись информации о завершении уровня в базу данных

4. **Обновление данных прогресса при завершении уровня:**
   - Создать метод в progressService для обновления статуса уровня
   - Реализовать обновление таблицы user_progress в Supabase
   - Добавить обработку обновления в реальном времени через Supabase Realtime
   - Настроить обновление общего прогресса пользователя

## Условия для завершения уровня

Уровень считается завершенным, когда выполнены следующие условия:
- Просмотрены все видео в уровне (минимум 85% каждого видео)
- Успешно пройдены все тесты (минимальный порог - 70% правильных ответов)
- Скачаны все обязательные артефакты

## Проверка работы

Для проверки корректности реализации завершения уровня выполните:
- Тестирование визуализации прогресса при различных сценариях
- Проверка корректности определения статуса завершения
- Тестирование функционала кнопки "Завершить уровень"
- Проверка обновления прогресса в базе данных
- Тестирование с различными условиями (полностью выполненные, частично выполненные)

## Ожидаемый результат

- Функциональный механизм определения завершенности уровня
- Компонент для отображения статуса и прогресса завершения
- Реализованная кнопка "Завершить уровень" с соответствующей логикой
- Корректное обновление прогресса в базе данных

## Дополнительные материалы

- [Designing Progress Indicators](https://uxplanet.org/progress-indicator-patterns-56ae036187c)
- [Gamification Patterns](https://uxplanet.org/gamification-in-ux-increasing-user-engagement-6437cbf702aa)
- [Supabase Realtime для обновления прогресса](https://supabase.com/docs/guides/realtime)
- [Оптимистичные обновления UI](https://react-query.tanstack.com/guides/optimistic-updates)

## После выполнения

После завершения задачи не забудьте обновить файл [status.md](../docs/status.md) с информацией о реализованном механизме завершения уровня, созданных компонентах и любых возникших проблемах при интеграции с системой прогресса. 