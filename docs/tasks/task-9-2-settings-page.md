# Задача 9.2: Реализация страницы настроек

## Подготовка

Перед началом выполнения задачи, пожалуйста, ознакомьтесь с следующими документами для восстановления контекста:
- [Концепция проекта](../docs/bizlevel-concept.md)
- [План разработки](../docs/development-plan.md)
- [Текущий статус проекта](../docs/status.md)

## Описание задачи

Необходимо разработать страницу настроек пользователя в приложении BizLevel, где пользователи смогут управлять своим профилем, изменять личные данные, менять пароль и настраивать параметры приложения.

### Шаги выполнения:

1. **Создание страницы настроек пользователя:**
   - Создать страницу `/app/(dashboard)/settings/page.tsx`
   - Разработать структуру страницы с разделами настроек
   - Реализовать переключение между разделами настроек
   - Настроить адаптивный дизайн для разных устройств

2. **Реализация смены личных данных:**
   - Создать форму редактирования профиля (имя, фамилия, контактные данные)
   - Реализовать валидацию полей с использованием React Hook Form и Zod
   - Добавить функцию сохранения изменений в базе данных
   - Реализовать обратную связь об успешном сохранении/ошибках

3. **Добавление возможности смены пароля:**
   - Разработать форму для смены пароля
   - Реализовать проверку текущего пароля
   - Добавить валидацию нового пароля (сложность, совпадение)
   - Реализовать процесс смены пароля через Supabase Auth

4. **Настройка уведомлений (опционально):**
   - Создать форму для настройки уведомлений
   - Добавить опции для разных типов уведомлений
   - Реализовать сохранение предпочтений в базе данных
   - Внедрить подсистему управления уведомлениями

## Структура страницы настроек

Страница настроек должна включать следующие разделы:
1. **Профиль** - редактирование основной информации о пользователе
2. **Безопасность** - смена пароля и настройки двухфакторной аутентификации (если применимо)
3. **Уведомления** - настройка получаемых уведомлений (опционально)
4. **Внешний вид** - настройки темы и отображения (опционально)
5. **Конфиденциальность** - управление доступом к данным (опционально)

## Обновление таблицы profiles

Для поддержки дополнительных настроек пользователя может потребоваться расширение таблицы profiles:

```sql
-- Предполагается, что таблица profiles уже существует
ALTER TABLE profiles 
  ADD COLUMN notification_settings JSONB DEFAULT '{"email": true, "push": false}'::JSONB,
  ADD COLUMN ui_settings JSONB DEFAULT '{"theme": "auto", "language": "ru"}'::JSONB,
  ADD COLUMN updated_at TIMESTAMPTZ;

-- Триггер для обновления updated_at
CREATE TRIGGER set_updated_at
BEFORE UPDATE ON profiles
FOR EACH ROW
EXECUTE PROCEDURE trigger_set_updated_at();
```

## Пример компонента смены пароля

```jsx
const ChangePasswordForm = () => {
  const form = useForm({
    resolver: zodResolver(changePasswordSchema),
    defaultValues: {
      currentPassword: '',
      newPassword: '',
      confirmPassword: '',
    },
  });
  
  const { supabase } = useSupabase();
  const { toast } = useToast();
  
  const onSubmit = async (data) => {
    try {
      const { error } = await supabase.auth.updatePassword({
        currentPassword: data.currentPassword,
        newPassword: data.newPassword,
      });
      
      if (error) throw error;
      
      toast({
        title: "Пароль успешно изменен",
        variant: "success",
      });
      
      form.reset();
    } catch (error) {
      toast({
        title: "Ошибка при смене пароля",
        description: error.message,
        variant: "destructive",
      });
    }
  };
  
  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        {/* Поля формы */}
        <Button type="submit" disabled={form.formState.isSubmitting}>
          {form.formState.isSubmitting ? "Сохранение..." : "Сменить пароль"}
        </Button>
      </form>
    </Form>
  );
};
```

## Проверка работы

Для проверки корректности реализации страницы настроек выполните:
- Тестирование процесса изменения личных данных
- Проверка процесса смены пароля
- Тестирование валидации форм при вводе некорректных данных
- Проверка сохранения настроек и их применения
- Тестирование адаптивности страницы на разных устройствах

## Ожидаемый результат

- Функциональная страница настроек пользователя
- Работающие формы изменения личных данных с валидацией
- Система смены пароля с проверкой текущего
- Сохранение предпочтений пользователя в базе данных
- Адаптивный дизайн страницы настроек

## Дополнительные материалы

- [React Hook Form](https://react-hook-form.com/)
- [Zod валидация](https://github.com/colinhacks/zod)
- [Supabase Auth API](https://supabase.com/docs/reference/javascript/auth-updateuser)
- [Shadcn/UI формы](https://ui.shadcn.com/docs/components/form)
- [Табы в Shadcn/UI](https://ui.shadcn.com/docs/components/tabs)

## После выполнения

После завершения задачи не забудьте обновить файл [status.md](../docs/status.md) с информацией о реализованной странице настроек, добавленных возможностях и любых возникших проблемах при разработке функционала. 