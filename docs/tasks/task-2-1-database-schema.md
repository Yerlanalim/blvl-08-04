# Задача 2.1: Создание схемы базы данных

## Подготовка

Перед началом выполнения задачи, пожалуйста, ознакомьтесь с следующими документами для восстановления контекста:
- [Концепция проекта](../docs/bizlevel-concept.md)
- [План разработки](../docs/development-plan.md)
- [Текущий статус проекта](../docs/status.md)

## Описание задачи

Необходимо создать схему базы данных PostgreSQL в Supabase согласно концепции проекта. Схема должна включать все основные таблицы, необходимые для функционирования приложения BizLevel.

### Шаги выполнения:

1. **Создание SQL миграций для основных таблиц:**
   - Создать миграцию для таблицы `profiles` (расширяющую auth.users)
   - Создать миграцию для таблицы `levels` (уровни обучения)
   - Создать миграцию для таблицы `videos` (видео внутри уровней)
   - Создать миграцию для таблицы `quiz_questions` (вопросы тестов)
   - Создать миграцию для таблицы `artifacts` (учебные материалы)

2. **Создание таблиц для отслеживания прогресса пользователей:**
   - Создать миграцию для таблицы `user_progress` (прогресс по уровням)
   - Создать миграцию для таблицы `user_video_progress` (просмотренные видео)
   - Создать миграцию для таблицы `user_artifacts` (скачанные артефакты)

3. **Применение миграций к базе данных:**
   - Применить созданные миграции с помощью Supabase CLI
   - Проверить корректность создания таблиц через интерфейс Supabase
   - **Важно:** Проверить, что все миграции применились успешно и таблицы созданы корректно

4. **Генерация TypeScript типов из схемы Supabase:**
   - Настроить генерацию типов из схемы базы данных
   - Сгенерировать типы для использования в приложении
   - Сохранить типы в соответствующей директории проекта

## Важные моменты для таблиц

При создании таблиц учитывайте следующие требования:
- Таблица `profiles` должна быть связана с `auth.users` через внешний ключ
- Таблица `levels` должна иметь поля для сортировки и статуса
- Таблица `videos` должна быть связана с уровнями и содержать URL-ссылки на YouTube
- Таблицы для прогресса должны иметь корректные внешние ключи и ограничения

## Проверка работы

Для проверки корректности созданной схемы выполните:
- Запрос к каждой таблице через SQL Editor в Supabase
- Проверка связей между таблицами через JOIN-запросы
- Тестовая вставка данных для проверки ограничений

## Ожидаемый результат

- Созданные и примененные SQL миграции для всех таблиц
- Корректно настроенные связи между таблицами
- Сгенерированные TypeScript типы для таблиц
- Подтвержденная работоспособность схемы базы данных

## Дополнительные материалы

- [Документация Supabase по миграциям](https://supabase.com/docs/reference/cli/supabase-migration)
- [Руководство по PostgreSQL](https://www.postgresql.org/docs/current/index.html)
- [Row Level Security в PostgreSQL](https://supabase.com/docs/guides/auth/row-level-security)

## После выполнения

После завершения задачи не забудьте обновить файл [status.md](../docs/status.md) с информацией о созданной схеме базы данных и любых возникших проблемах при создании и применении миграций. 