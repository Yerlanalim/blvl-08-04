# Задача 2.2: Настройка аутентификации

## Подготовка

Перед началом выполнения задачи, пожалуйста, ознакомьтесь с следующими документами для восстановления контекста:
- [Концепция проекта](../docs/bizlevel-concept.md)
- [План разработки](../docs/development-plan.md)
- [Текущий статус проекта](../docs/status.md)

## Описание задачи

Необходимо настроить систему аутентификации в проекте BizLevel с использованием Supabase Auth и реализовать Row Level Security (RLS) для основных таблиц.

### Шаги выполнения:

1. **Настройка Supabase Auth для Email/Password:**
   - Настроить Email/Password аутентификацию в Supabase Dashboard
   - Настроить параметры подтверждения Email (если нужно)
   - Настроить шаблоны писем для регистрации/восстановления пароля
   - Проверить работоспособность регистрации через Supabase Dashboard

2. **Создание клиента Supabase и SupabaseProvider:**
   - Расширить существующий клиент Supabase для работы с аутентификацией
   - Создать провайдер контекста для Supabase в React (SupabaseProvider)
   - Настроить обработку сессий и состояния авторизации
   - Реализовать логику автообновления токенов сессии

3. **Настройка Row Level Security (RLS) для основных таблиц:**
   - Создать SQL-миграцию для настройки RLS на таблицах
   - Настроить политики доступа для таблиц profiles, levels, videos и др.
   - Настроить различные уровни доступа для обычных пользователей и администраторов
   - Проверить корректную работу политик через тестовые запросы

4. **Реализация хука useAuth для работы с аутентификацией:**
   - Создать пользовательский хук useAuth для работы с аутентификацией
   - Реализовать методы signUp, signIn, signOut, resetPassword
   - Добавить обработку состояния загрузки и ошибок
   - Реализовать методы получения текущего пользователя и его данных

## Проверка работы

Для проверки корректности настройки аутентификации выполните:
- Тестовая регистрация нового пользователя
- Тестовый вход в систему с созданными учетными данными
- Проверка работы RLS-политик для разных пользователей
- Проверка возможности восстановления пароля

**Важно:** Проверьте, что разные пользователи имеют доступ только к тем данным, к которым должны иметь согласно RLS-политикам.

## Ожидаемый результат

- Настроенная система аутентификации Email/Password
- Реализованный SupabaseProvider для React
- Настроенные RLS-политики для основных таблиц
- Работающий хук useAuth для управления аутентификацией
- Подтвержденная безопасность доступа к данным

## Дополнительные материалы

- [Документация Supabase Auth](https://supabase.com/docs/guides/auth)
- [Row Level Security в Supabase](https://supabase.com/docs/guides/auth/row-level-security)
- [React Context API](https://reactjs.org/docs/context.html)
- [React Hooks](https://reactjs.org/docs/hooks-intro.html)

## После выполнения

После завершения задачи не забудьте обновить файл [status.md](../docs/status.md) с информацией о настроенной системе аутентификации, реализованных RLS-политиках и любых возникших проблемах при настройке безопасности. 