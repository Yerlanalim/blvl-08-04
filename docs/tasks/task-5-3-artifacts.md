# Задача 5.3: Работа с артефактами

## Подготовка

Перед началом выполнения задачи, пожалуйста, ознакомьтесь с следующими документами для восстановления контекста:
- [Концепция проекта](../docs/bizlevel-concept.md)
- [План разработки](../docs/development-plan.md)
- [Текущий статус проекта](../docs/status.md)

## Описание задачи

Необходимо создать систему для работы с учебными материалами (артефактами) в приложении BizLevel. Пользователи должны иметь возможность просматривать список доступных артефактов, связанных с уровнями обучения, скачивать их и отслеживать, какие артефакты уже были скачаны.

### Шаги выполнения:

1. **Создание сервиса artifactService для работы с артефактами:**
   - Разработать сервис для взаимодействия с таблицей artifacts в Supabase
   - Реализовать методы для получения списка артефактов по уровню
   - Добавить функционал для получения ссылок на скачивание из Supabase Storage
   - Реализовать механизм отслеживания скачанных артефактов

2. **Реализация компонента для отображения и скачивания артефактов:**
   - Создать компонент ArtifactSection для страницы уровня
   - Реализовать отображение списка артефактов с метаданными (название, описание, размер, тип)
   - Добавить кнопки для скачивания файлов
   - Реализовать индикацию уже скачанных артефактов

3. **Настройка интеграции с Supabase Storage для хранения файлов:**
   - Настроить корзины (buckets) в Supabase Storage для хранения артефактов
   - Реализовать получение подписанных URL для безопасного скачивания
   - Настроить политики доступа к файлам в соответствии с прогрессом пользователя
   - Добавить механизм обработки ошибок при недоступности файлов

4. **Отслеживание скачанных артефактов в прогрессе:**
   - Создать логику записи информации о скачанных артефактах в таблицу user_artifacts
   - Интегрировать скачивание артефактов с общим прогрессом пользователя
   - Реализовать обновление прогресса в реальном времени
   - Добавить страницу или раздел для просмотра всех скачанных артефактов

## Структура данных для артефактов

Рекомендуемая структура таблицы artifacts:
- id: уникальный идентификатор артефакта
- level_id: связь с уровнем
- title: название артефакта
- description: описание артефакта
- file_path: путь к файлу в Supabase Storage
- file_type: тип файла (pdf, docx, xlsx и т.д.)
- file_size: размер файла в байтах
- created_at: дата добавления артефакта

Структура таблицы user_artifacts:
- id: уникальный идентификатор записи
- user_id: идентификатор пользователя
- artifact_id: идентификатор артефакта
- downloaded_at: дата и время скачивания

## Рекомендации по реализации

- Используйте Supabase Storage для хранения файлов артефактов
- Реализуйте механизм подписанных URL для безопасного скачивания
- Добавьте прогресс-бар для отображения процесса скачивания больших файлов
- Предусмотрите кеширование метаданных артефактов для ускорения загрузки интерфейса

## Проверка работы

Для проверки корректности реализации работы с артефактами выполните:
- Тестирование отображения списка артефактов для разных уровней
- Проверка процесса скачивания файлов разных типов и размеров
- Тестирование отслеживания скачанных артефактов в прогрессе
- Проверка обновления общего прогресса пользователя
- Тестирование доступности артефактов в соответствии с прогрессом

## Ожидаемый результат

- Функциональный сервис для работы с артефактами
- Компонент для отображения и скачивания учебных материалов
- Настроенная интеграция с Supabase Storage
- Система отслеживания скачанных артефактов в прогрессе пользователя

## Дополнительные материалы

- [Документация Supabase Storage](https://supabase.com/docs/guides/storage)
- [Подписанные URL в Supabase](https://supabase.com/docs/reference/javascript/storage-from-createsignedurl)
- [Примеры UI для файловых систем](https://dribbble.com/tags/file_system)
- [Управление загрузками в браузере](https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/File_drag_and_drop)

## После выполнения

После завершения задачи не забудьте обновить файл [status.md](../docs/status.md) с информацией о реализованной системе работы с артефактами, интеграции с Supabase Storage и механизме отслеживания скачанных материалов. 